<!DOCTYPE html>
<html>
  <head>
    <title>Hologram Tanterem - Forgathat√≥ Metszetek</title>
    <meta charset="utf-8">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
        
    <style>
      /* Gombok st√≠lusa √©s elhelyez√©se */
      .gomb-tarolo {
        position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
        display: flex; gap: 10px; z-index: 9999;
      }
      
      .vezerlo-gomb {
        padding: 15px 25px; font-size: 16px; color: white; border: none; 
        border-radius: 8px; cursor: pointer; font-family: sans-serif; font-weight: bold;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: 0.2s;
      }

      .gomb-zold { background-color: #4CAF50; } /* Be/Ki gomb */
      .gomb-zold:hover { background-color: #45a049; }

      .gomb-kek { background-color: #2196F3; } /* L√©ptet≈ë gomb */
      .gomb-kek:hover { background-color: #0b7dda; }
    </style>

    <script>
      // 1. MODUL: H√ÅROMSZ√ñG RAJZOL√ì
      AFRAME.registerComponent('haromszog-rajzolo', {
        schema: {
          A: {type: 'vec3', default: {x: 0, y: 0, z: 0}},
          B: {type: 'vec3', default: {x: 0, y: 1, z: 0}},
          C: {type: 'vec3', default: {x: 1, y: 0, z: 0}},
          szin: {type: 'color', default: 'yellow'}
        },
        update: function () { // 'init' helyett 'update', hogy reag√°ljon a v√°ltoz√°sra!
          var data = this.data;
          var geometry = new THREE.BufferGeometry();
          var vertices = new Float32Array([
            data.A.x, data.A.y, data.A.z,
            data.B.x, data.B.y, data.B.z,
            data.C.x, data.C.y, data.C.z
          ]);
          geometry.setAttribute('position', new THREE.BufferAttribute(vertices, 3));
          geometry.computeVertexNormals(); 

          // Ha m√°r van mesh, t√∂r√∂lj√ºk a r√©git (mem√≥riakezel√©s)
          if (this.mesh) this.el.getObject3D('mesh').geometry.dispose();

          var material = new THREE.MeshBasicMaterial({
            color: data.szin, side: THREE.DoubleSide, opacity: 0.9, transparent: true, depthTest: false
          });

          this.mesh = new THREE.Mesh(geometry, material);
          this.el.setObject3D('mesh', this.mesh);
        }
      });

      // 2. MODUL: TISZTA KERET
      AFRAME.registerComponent('tiszta-keret', {
        schema: {
          szelesseg: {type: 'number', default: 2},
          magassag: {type: 'number', default: 2},
          melyseg:   {type: 'number', default: 2},
          szin:      {type: 'color', default: 'white'}
        },
        init: function () {
          var data = this.data;
          var geometry = new THREE.BoxGeometry(data.szelesseg, data.magassag, data.melyseg);
          var edges = new THREE.EdgesGeometry(geometry); 
          var material = new THREE.LineBasicMaterial({ color: data.szin });
          this.el.setObject3D('mesh', new THREE.LineSegments(edges, material));
        }
      });
    </script>
  </head>
  <body>
    
    <div class="gomb-tarolo">
      <button class="vezerlo-gomb gomb-zold" onclick="metszetBeKi()">
        üëÅÔ∏è Be/Ki
      </button>
      <button class="vezerlo-gomb gomb-kek" onclick="kovetkezoMetszet()">
        ‚û°Ô∏è K√∂vetkez≈ë
      </button>
    </div>

    <a-scene renderer="sortObjects: true; antialias: true">
      
      <a-entity id="szoba">
        <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" color="#8B5A2B"></a-plane>
        <a-plane position="0 4 0" rotation="90 0 0" width="10" height="10" color="#FFFFFF"></a-plane>
        <a-plane position="0 2 -5" width="10" height="4" color="#F5F5DC"></a-plane>
        <a-plane position="0 2 -4.9" width="4" height="1.5" color="#1A531B"></a-plane> <a-plane position="-5 2 0" rotation="0 90 0" width="10" height="4" color="#F5F5DC"></a-plane>
        <a-plane position="5 2 0" rotation="0 -90 0" width="10" height="4" color="#F5F5DC"></a-plane>
        <a-plane position="0 2 5" rotation="0 180 0" width="10" height="4" color="#F5F5DC"></a-plane>
      </a-entity>

      <a-entity light="type: ambient; color: #FFF; intensity: 0.6"></a-entity>
      <a-entity light="type: point; intensity: 0.7; distance: 20" position="0 3.5 0"></a-entity>

      <a-entity position="0 1.6 0" animation="property: rotation; to: 0 360 0; loop: true; dur: 30000; easing: linear">
        
        <a-box id="kocka" position="0 0 0" width="2" height="2" depth="2"
               material="color: #00ff00; opacity: 0.1; transparent: true; side: double; depthWrite: false">
               <a-entity tiszta-keret="szelesseg: 2; magassag: 2; melyseg: 2; szin: white"></a-entity>
        </a-box>

        <a-entity id="metszet" visible="false"
                  haromszog-rajzolo="A: -1 -1 -1; B: 1 1 -1; C: 1 1 1; szin: #FFD700">
        </a-entity>

        <a-sphere id="pontA" position="-1 -1 -1" radius="0.05" color="red"></a-sphere>
        <a-sphere id="pontB" position="1 1 -1" radius="0.05" color="blue"></a-sphere>
        <a-sphere id="pontC" position="1 1 1" radius="0.05" color="green"></a-sphere>

      </a-entity>

      <a-entity id="rig" position="0 1.6 3.5">
        <a-entity camera look-controls wasd-controls></a-entity>
      </a-entity>

    </a-scene>

    <script>
      // ADATB√ÅZIS: Itt t√°roljuk a k√ºl√∂nb√∂z≈ë h√°romsz√∂geket (4 forgat√°si ir√°ny)
      // A Kocka cs√∫csai: -1 √©s 1 k√∂z√∂tt vannak.
      var metszetLista = [
        // 1. Eredeti (Test√°tl√≥ h√°tulr√≥l el≈ëre)
        { A: "-1 -1 -1", B: "1 1 -1", C: "1 1 1" },
        
        // 2. Elforgatva 90 fokkal (Jobb oldalr√≥l n√©zve)
        { A: "1 -1 -1", B: "1 1 1", C: "-1 1 1" },
        
        // 3. Elforgatva 180 fokkal (H√°tulr√≥l n√©zve)
        { A: "1 -1 1", B: "-1 1 1", C: "-1 1 -1" },
        
        // 4. Elforgatva 270 fokkal (Bal oldalr√≥l n√©zve)
        { A: "-1 -1 1", B: "-1 1 -1", C: "1 1 -1" }
      ];

      var jelenlegiIndex = 0; // Melyiket mutatjuk √©ppen

      function metszetBeKi() {
        var metszetElem = document.querySelector('#metszet');
        var jelenlegi = metszetElem.getAttribute('visible');
        metszetElem.setAttribute('visible', !jelenlegi);
      }

      function kovetkezoMetszet() {
        // 1. L√©ptetj√ºk az indexet (0 -> 1 -> 2 -> 3 -> 0 ...)
        jelenlegiIndex++;
        if (jelenlegiIndex >= metszetLista.length) {
          jelenlegiIndex = 0;
        }

        // 2. Kiv√°lasztjuk az √∫j adatokat
        var ujAdatok = metszetLista[jelenlegiIndex];

        // 3. Friss√≠tj√ºk a H√ÅROMSZ√ñGET
        var metszetElem = document.querySelector('#metszet');
        
        // Fontos: stringet rakunk √∂ssze az attrib√∫tumhoz
        // Pl: "A: -1 -1 -1; B: 1 1 -1; ..."
        var attrString = "A: " + ujAdatok.A + "; B: " + ujAdatok.B + "; C: " + ujAdatok.C + "; szin: #FFD700";
        metszetElem.setAttribute('haromszog-rajzolo', attrString);

        // 4. Friss√≠tj√ºk a P√ñTTY√ñKET is, hogy k√∂vess√©k a cs√∫csokat
        document.querySelector('#pontA').setAttribute('position', ujAdatok.A);
        document.querySelector('#pontB').setAttribute('position', ujAdatok.B);
        document.querySelector('#pontC').setAttribute('position', ujAdatok.C);

        // 5. Ha esetleg ki volt kapcsolva, kapcsoljuk be, hogy l√°ssa a v√°ltoz√°st
        metszetElem.setAttribute('visible', true);
      }
    </script>
  </body>
</html>
